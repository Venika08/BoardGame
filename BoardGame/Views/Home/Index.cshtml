@using WebMatrix.Data;

@{
    ViewBag.Title = "Home Page";

    var db = Database.Open("BoardGame");

    var tableView = Request.QueryString["tableView"] ?? "table"; // the default is table

    var searchText = Request.QueryString["searchText"] ?? "";

    var sql = "SELECT * FROM BoardGame WHERE Name LIKE CONCAT(@0, '%')";

    var data = db.Query(sql, searchText);


}

<div class="py -1 mt-2 bg-light text-center">
    <h2 class="text-center">Index Page</h2>
</div>

<form method="get" action="/Home/Index" class="row">
    <div class="col-3"><input type="text" name="searchText" id="searchText" class="form-control" placeholder="Search Board Game Information" value="@searchText" /></div>
    <div class="col-2"><button type="submit" class="btn btn-primary">Search</button></div>
    <input type="hidden" id="tableView" name="tableView" value="@tableView" />

    <!-- Toggle Button -->
    <div class="theme-toggle">
        <button type="submit" id="toggleBtn" class="btn btn-secondary" onclick="document.getElementById('tableView').value = 'table'"><b>Table View</b></button>
        <button type="submit" id="toggleBtn" class="btn btn-secondary" onclick="document.getElementById('tableView').value = 'card'"><b>Card View</b></button>

    </div>
</form>


<!--Display table mode-->
@if (data.Count() > 0)
{
    if (tableView == "table")
    {
        <div id="tableView">
            <div class="col-12">
                <table class="table table-striped" style="table-layout: fixed; width: 100%;">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Name</th>
                            <th scope="col">Year</th>
                            <th scope="col"> Min Players</th>
                            <th scope="col"> Max Players</th>
                            <th scope="col"> Recommended Age</th>
                            <th scope="col">Ranking </th>
                            <th scope="col">Language Ease</th>
                            <th scope="col"> Details </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in data)
                        {
                            <tr>
                                <td> @item.BGGId </td>
                                <td> @item.Name </td>
                                <td> @item.YearPublished </td>
                                <td> @item.MinPlayers </td>
                                <td> @item.MaxPlayers </td>
                                <td> @item.MfgAgeRec </td>
                                <td> @item.LanguageEase</td>
                                <td> @item.RankInboardgame </td>
                                <td>
                                    <a href="/Home/Details?id=@item.BGGId" class="btn btn-sm btn-secondary">View Detail</a>
                                </td>

                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else if (tableView == "card")
    {
        <div id="cardView">
            <div class="row row-cols-1 row-cols-md-3 g-4">
                @foreach (var item in data)
                {
                    <div class="col">
                        <div class="card h-100">
                            <img src="@item.ImagePath" class="card-img-top" alt="@item.Name" style="height:100px;object-fit:cover" />
                            <div class="card-body">
                                <h3 class="card-title"> @item.Name </h3>
                                <p class="card-text"> @item.Description </p>
                                <ul class="list-styled">
                                    <li><strong> Year: </strong> @item.YearPublished </li>
                                    <li><strong> Family: </strong> @item.Family </li>
                                    <li><strong> Minimum Players: </strong> @item.MinPlayers </li>
                                    <li><strong> Maximum Players: </strong> @item.MaxPlayers </li>
                                    <li><strong> Age Recommend: </strong> @item.MfgAgeRec </li>
                                    <li><strong> Language Ease: </strong> @item.LanguageEase</li>
                                    <li><strong> Ranking: </strong> @item.RankInboardgame </li>
                                </ul>
                                <a href="/Home/Details?id=@item.BGGId" class="btn btn-secondary" target="_blank"> View Detail </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
}
else
{
    <h2 class="text-danger text-center">Oops! No matching boarding games! </h2>
}



<!----var categories = db.Query("SELECT DISTINCT Category from dbo.Category ORDER BY Category")-->
<!---if (selectedcategories != "")
{
    selectQueryString += "AND c.Category = 1";
}

selectQueryString += " ORDER BY b.Name ASC";

var data = (selectedcateogires != "")

    ? db.Query(selecQueryString, searchText, selectedCategories)

    : db.Query(selectQuery)-->
